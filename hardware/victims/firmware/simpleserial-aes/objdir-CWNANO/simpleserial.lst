   1              		.cpu cortex-m0
   2              		.eabi_attribute 20, 1
   3              		.eabi_attribute 21, 1
   4              		.eabi_attribute 23, 3
   5              		.eabi_attribute 24, 1
   6              		.eabi_attribute 25, 1
   7              		.eabi_attribute 26, 1
   8              		.eabi_attribute 30, 4
   9              		.eabi_attribute 34, 0
  10              		.eabi_attribute 18, 4
  11              		.file	"simpleserial.c"
  12              		.text
  13              	.Ltext0:
  14              		.cfi_sections	.debug_frame
  15              		.section	.text.ss_crc,"ax",%progbits
  16              		.align	1
  17              		.global	ss_crc
  18              		.arch armv6s-m
  19              		.syntax unified
  20              		.code	16
  21              		.thumb_func
  22              		.fpu softvfp
  24              	ss_crc:
  25              	.LVL0:
  26              	.LFB0:
  27              		.file 1 ".././simpleserial/simpleserial.c"
   1:.././simpleserial/simpleserial.c **** // simpleserial.c
   2:.././simpleserial/simpleserial.c **** 
   3:.././simpleserial/simpleserial.c **** #include "simpleserial.h"
   4:.././simpleserial/simpleserial.c **** #include <stdint.h>
   5:.././simpleserial/simpleserial.c **** #include "hal.h"
   6:.././simpleserial/simpleserial.c **** 
   7:.././simpleserial/simpleserial.c **** 
   8:.././simpleserial/simpleserial.c **** #define MAX_SS_CMDS 16
   9:.././simpleserial/simpleserial.c **** static int num_commands = 0;
  10:.././simpleserial/simpleserial.c **** 
  11:.././simpleserial/simpleserial.c **** #define MAX_SS_LEN 256
  12:.././simpleserial/simpleserial.c **** 
  13:.././simpleserial/simpleserial.c **** //#define SS_VER_1_0 0
  14:.././simpleserial/simpleserial.c **** //#define SS_VER_1_1 1
  15:.././simpleserial/simpleserial.c **** //#define SS_VER_2_0 2
  16:.././simpleserial/simpleserial.c **** 
  17:.././simpleserial/simpleserial.c **** 
  18:.././simpleserial/simpleserial.c **** // 0xA6 formerly 
  19:.././simpleserial/simpleserial.c **** #define CW_CRC 0x4D 
  20:.././simpleserial/simpleserial.c **** uint8_t ss_crc(uint8_t *buf, uint8_t len)
  21:.././simpleserial/simpleserial.c **** {
  28              		.loc 1 21 1 view -0
  29              		.cfi_startproc
  30              		@ args = 0, pretend = 0, frame = 0
  31              		@ frame_needed = 0, uses_anonymous_args = 0
  22:.././simpleserial/simpleserial.c **** 	unsigned int k = 0;
  32              		.loc 1 22 2 view .LVU1
  23:.././simpleserial/simpleserial.c **** 	uint8_t crc = 0x00;
  33              		.loc 1 23 2 view .LVU2
  24:.././simpleserial/simpleserial.c **** 	while (len--) {
  34              		.loc 1 24 2 view .LVU3
  35 0000 0300     		movs	r3, r0
  21:.././simpleserial/simpleserial.c **** 	unsigned int k = 0;
  36              		.loc 1 21 1 is_stmt 0 view .LVU4
  37 0002 70B5     		push	{r4, r5, r6, lr}
  38              	.LCFI0:
  39              		.cfi_def_cfa_offset 16
  40              		.cfi_offset 4, -16
  41              		.cfi_offset 5, -12
  42              		.cfi_offset 6, -8
  43              		.cfi_offset 14, -4
  44 0004 4118     		adds	r1, r0, r1
  45              	.LVL1:
  25:.././simpleserial/simpleserial.c **** 		crc ^= *buf++;
  26:.././simpleserial/simpleserial.c **** 		for (k = 0; k < 8; k++) {
  27:.././simpleserial/simpleserial.c **** 			crc = crc & 0x80 ? (crc << 1) ^ CW_CRC: crc << 1;
  46              		.loc 1 27 34 view .LVU5
  47 0006 4D25     		movs	r5, #77
  23:.././simpleserial/simpleserial.c **** 	while (len--) {
  48              		.loc 1 23 10 view .LVU6
  49 0008 0020     		movs	r0, #0
  50              	.LVL2:
  51              	.L2:
  24:.././simpleserial/simpleserial.c **** 		crc ^= *buf++;
  52              		.loc 1 24 8 is_stmt 1 view .LVU7
  24:.././simpleserial/simpleserial.c **** 		crc ^= *buf++;
  53              		.loc 1 24 8 is_stmt 0 view .LVU8
  54 000a 9942     		cmp	r1, r3
  55 000c 00D1     		bne	.L6
  28:.././simpleserial/simpleserial.c **** 		}
  29:.././simpleserial/simpleserial.c **** 	}
  30:.././simpleserial/simpleserial.c **** 	return crc;
  56              		.loc 1 30 2 is_stmt 1 view .LVU9
  31:.././simpleserial/simpleserial.c **** 
  32:.././simpleserial/simpleserial.c **** }
  57              		.loc 1 32 1 is_stmt 0 view .LVU10
  58              		@ sp needed
  59 000e 70BD     		pop	{r4, r5, r6, pc}
  60              	.L6:
  25:.././simpleserial/simpleserial.c **** 		for (k = 0; k < 8; k++) {
  61              		.loc 1 25 3 is_stmt 1 view .LVU11
  62              	.LVL3:
  25:.././simpleserial/simpleserial.c **** 		for (k = 0; k < 8; k++) {
  63              		.loc 1 25 7 is_stmt 0 view .LVU12
  64 0010 0824     		movs	r4, #8
  65 0012 1A78     		ldrb	r2, [r3]
  66 0014 5040     		eors	r0, r2
  67              	.LVL4:
  26:.././simpleserial/simpleserial.c **** 			crc = crc & 0x80 ? (crc << 1) ^ CW_CRC: crc << 1;
  68              		.loc 1 26 3 is_stmt 1 view .LVU13
  26:.././simpleserial/simpleserial.c **** 			crc = crc & 0x80 ? (crc << 1) ^ CW_CRC: crc << 1;
  69              		.loc 1 26 15 view .LVU14
  70              	.L5:
  27:.././simpleserial/simpleserial.c **** 		}
  71              		.loc 1 27 4 view .LVU15
  27:.././simpleserial/simpleserial.c **** 		}
  72              		.loc 1 27 8 is_stmt 0 view .LVU16
  73 0016 46B2     		sxtb	r6, r0
  74 0018 4200     		lsls	r2, r0, #1
  75 001a D0B2     		uxtb	r0, r2
  76              	.LVL5:
  27:.././simpleserial/simpleserial.c **** 		}
  77              		.loc 1 27 8 view .LVU17
  78 001c 002E     		cmp	r6, #0
  79 001e 01DA     		bge	.L4
  27:.././simpleserial/simpleserial.c **** 		}
  80              		.loc 1 27 34 discriminator 1 view .LVU18
  81 0020 6A40     		eors	r2, r5
  27:.././simpleserial/simpleserial.c **** 		}
  82              		.loc 1 27 8 discriminator 1 view .LVU19
  83 0022 D0B2     		uxtb	r0, r2
  84              	.L4:
  85              	.LVL6:
  26:.././simpleserial/simpleserial.c **** 			crc = crc & 0x80 ? (crc << 1) ^ CW_CRC: crc << 1;
  86              		.loc 1 26 22 is_stmt 1 discriminator 4 view .LVU20
  26:.././simpleserial/simpleserial.c **** 			crc = crc & 0x80 ? (crc << 1) ^ CW_CRC: crc << 1;
  87              		.loc 1 26 15 discriminator 4 view .LVU21
  26:.././simpleserial/simpleserial.c **** 			crc = crc & 0x80 ? (crc << 1) ^ CW_CRC: crc << 1;
  88              		.loc 1 26 3 is_stmt 0 discriminator 4 view .LVU22
  89 0024 013C     		subs	r4, r4, #1
  90              	.LVL7:
  26:.././simpleserial/simpleserial.c **** 			crc = crc & 0x80 ? (crc << 1) ^ CW_CRC: crc << 1;
  91              		.loc 1 26 3 discriminator 4 view .LVU23
  92 0026 002C     		cmp	r4, #0
  93 0028 F5D1     		bne	.L5
  94 002a 0133     		adds	r3, r3, #1
  95              	.LVL8:
  26:.././simpleserial/simpleserial.c **** 			crc = crc & 0x80 ? (crc << 1) ^ CW_CRC: crc << 1;
  96              		.loc 1 26 3 discriminator 4 view .LVU24
  97 002c EDE7     		b	.L2
  98              		.cfi_endproc
  99              	.LFE0:
 101              		.section	.text.hex_decode,"ax",%progbits
 102              		.align	1
 103              		.global	hex_decode
 104              		.syntax unified
 105              		.code	16
 106              		.thumb_func
 107              		.fpu softvfp
 109              	hex_decode:
 110              	.LVL9:
 111              	.LFB1:
  33:.././simpleserial/simpleserial.c **** 
  34:.././simpleserial/simpleserial.c **** // [B_STUFF, CMD, SCMD, LEN, B_STUFF, DATA..., CRC, TERM]
  35:.././simpleserial/simpleserial.c **** 
  36:.././simpleserial/simpleserial.c **** //#define SS_VER SS_VER_2_0
  37:.././simpleserial/simpleserial.c **** #if SS_VER == SS_VER_2_0
  38:.././simpleserial/simpleserial.c **** #error "SS_VER_2_0 is deprecated! Use SS_VER_2_1 instead."
  39:.././simpleserial/simpleserial.c **** #elif SS_VER == SS_VER_2_1
  40:.././simpleserial/simpleserial.c **** 
  41:.././simpleserial/simpleserial.c **** int hex_decode(int len, char* ascii_buf, uint8_t* data_buf)
  42:.././simpleserial/simpleserial.c **** {
 112              		.loc 1 42 1 is_stmt 1 view -0
 113              		.cfi_startproc
 114              		@ args = 0, pretend = 0, frame = 0
 115              		@ frame_needed = 0, uses_anonymous_args = 0
  43:.././simpleserial/simpleserial.c **** 	for(int i = 0; i < len; i++)
 116              		.loc 1 43 2 view .LVU26
 117              	.LBB2:
 118              		.loc 1 43 6 view .LVU27
 119              		.loc 1 43 6 is_stmt 0 view .LVU28
 120              	.LBE2:
  42:.././simpleserial/simpleserial.c **** 	for(int i = 0; i < len; i++)
 121              		.loc 1 42 1 view .LVU29
 122 0000 70B5     		push	{r4, r5, r6, lr}
 123              	.LCFI1:
 124              		.cfi_def_cfa_offset 16
 125              		.cfi_offset 4, -16
 126              		.cfi_offset 5, -12
 127              		.cfi_offset 6, -8
 128              		.cfi_offset 14, -4
 129              	.LBB6:
 130              		.loc 1 43 2 view .LVU30
 131 0002 1400     		movs	r4, r2
 132              	.LVL10:
 133              	.L9:
 134              		.loc 1 43 17 is_stmt 1 discriminator 1 view .LVU31
 135              		.loc 1 43 2 is_stmt 0 discriminator 1 view .LVU32
 136 0004 A31A     		subs	r3, r4, r2
 137 0006 9842     		cmp	r0, r3
 138 0008 01DC     		bgt	.L19
 139              	.LBE6:
  44:.././simpleserial/simpleserial.c **** 	{
  45:.././simpleserial/simpleserial.c **** 		char n_hi = ascii_buf[2*i];
  46:.././simpleserial/simpleserial.c **** 		char n_lo = ascii_buf[2*i+1];
  47:.././simpleserial/simpleserial.c **** 
  48:.././simpleserial/simpleserial.c **** 		if(n_lo >= '0' && n_lo <= '9')
  49:.././simpleserial/simpleserial.c **** 			data_buf[i] = n_lo - '0';
  50:.././simpleserial/simpleserial.c **** 		else if(n_lo >= 'A' && n_lo <= 'F')
  51:.././simpleserial/simpleserial.c **** 			data_buf[i] = n_lo - 'A' + 10;
  52:.././simpleserial/simpleserial.c **** 		else if(n_lo >= 'a' && n_lo <= 'f')
  53:.././simpleserial/simpleserial.c **** 			data_buf[i] = n_lo - 'a' + 10;
  54:.././simpleserial/simpleserial.c **** 		else
  55:.././simpleserial/simpleserial.c **** 			return 1;
  56:.././simpleserial/simpleserial.c **** 
  57:.././simpleserial/simpleserial.c **** 		if(n_hi >= '0' && n_hi <= '9')
  58:.././simpleserial/simpleserial.c **** 			data_buf[i] |= (n_hi - '0') << 4;
  59:.././simpleserial/simpleserial.c **** 		else if(n_hi >= 'A' && n_hi <= 'F')
  60:.././simpleserial/simpleserial.c **** 			data_buf[i] |= (n_hi - 'A' + 10) << 4;
  61:.././simpleserial/simpleserial.c **** 		else if(n_hi >= 'a' && n_hi <= 'f')
  62:.././simpleserial/simpleserial.c **** 			data_buf[i] |= (n_hi - 'a' + 10) << 4;
  63:.././simpleserial/simpleserial.c **** 		else
  64:.././simpleserial/simpleserial.c **** 			return 1;
  65:.././simpleserial/simpleserial.c **** 	}
  66:.././simpleserial/simpleserial.c **** 
  67:.././simpleserial/simpleserial.c **** 	return 0;
 140              		.loc 1 67 9 view .LVU33
 141 000a 0020     		movs	r0, #0
 142              	.LVL11:
 143              		.loc 1 67 9 view .LVU34
 144 000c 1FE0     		b	.L8
 145              	.LVL12:
 146              	.L19:
 147              	.LBB7:
 148              	.LBB3:
  45:.././simpleserial/simpleserial.c **** 		char n_lo = ascii_buf[2*i+1];
 149              		.loc 1 45 3 is_stmt 1 view .LVU35
  46:.././simpleserial/simpleserial.c **** 
 150              		.loc 1 46 8 is_stmt 0 view .LVU36
 151 000e 4D78     		ldrb	r5, [r1, #1]
  45:.././simpleserial/simpleserial.c **** 		char n_lo = ascii_buf[2*i+1];
 152              		.loc 1 45 8 view .LVU37
 153 0010 0B78     		ldrb	r3, [r1]
 154              	.LVL13:
  46:.././simpleserial/simpleserial.c **** 
 155              		.loc 1 46 3 is_stmt 1 view .LVU38
  48:.././simpleserial/simpleserial.c **** 			data_buf[i] = n_lo - '0';
 156              		.loc 1 48 3 view .LVU39
  48:.././simpleserial/simpleserial.c **** 			data_buf[i] = n_lo - '0';
 157              		.loc 1 48 18 is_stmt 0 view .LVU40
 158 0012 2E00     		movs	r6, r5
 159 0014 303E     		subs	r6, r6, #48
 160 0016 F6B2     		uxtb	r6, r6
  48:.././simpleserial/simpleserial.c **** 			data_buf[i] = n_lo - '0';
 161              		.loc 1 48 5 view .LVU41
 162 0018 092E     		cmp	r6, #9
 163 001a 0CD8     		bhi	.L10
  49:.././simpleserial/simpleserial.c **** 		else if(n_lo >= 'A' && n_lo <= 'F')
 164              		.loc 1 49 4 is_stmt 1 view .LVU42
  49:.././simpleserial/simpleserial.c **** 		else if(n_lo >= 'A' && n_lo <= 'F')
 165              		.loc 1 49 16 is_stmt 0 view .LVU43
 166 001c 2670     		strb	r6, [r4]
 167              	.LVL14:
 168              	.L11:
  57:.././simpleserial/simpleserial.c **** 			data_buf[i] |= (n_hi - '0') << 4;
 169              		.loc 1 57 3 is_stmt 1 view .LVU44
  57:.././simpleserial/simpleserial.c **** 			data_buf[i] |= (n_hi - '0') << 4;
 170              		.loc 1 57 18 is_stmt 0 view .LVU45
 171 001e 1D00     		movs	r5, r3
 172 0020 303D     		subs	r5, r5, #48
  57:.././simpleserial/simpleserial.c **** 			data_buf[i] |= (n_hi - '0') << 4;
 173              		.loc 1 57 5 view .LVU46
 174 0022 EEB2     		uxtb	r6, r5
 175 0024 092E     		cmp	r6, #9
 176 0026 15D8     		bhi	.L15
  58:.././simpleserial/simpleserial.c **** 		else if(n_hi >= 'A' && n_hi <= 'F')
 177              		.loc 1 58 4 is_stmt 1 view .LVU47
  58:.././simpleserial/simpleserial.c **** 		else if(n_hi >= 'A' && n_hi <= 'F')
 178              		.loc 1 58 16 is_stmt 0 view .LVU48
 179 0028 2378     		ldrb	r3, [r4]
 180              	.LVL15:
  58:.././simpleserial/simpleserial.c **** 		else if(n_hi >= 'A' && n_hi <= 'F')
 181              		.loc 1 58 32 view .LVU49
 182 002a 2D01     		lsls	r5, r5, #4
 183              	.LVL16:
  58:.././simpleserial/simpleserial.c **** 		else if(n_hi >= 'A' && n_hi <= 'F')
 184              		.loc 1 58 16 view .LVU50
 185 002c 1D43     		orrs	r5, r3
 186 002e 2570     		strb	r5, [r4]
 187              	.L16:
  58:.././simpleserial/simpleserial.c **** 		else if(n_hi >= 'A' && n_hi <= 'F')
 188              		.loc 1 58 16 view .LVU51
 189              	.LBE3:
  43:.././simpleserial/simpleserial.c **** 	{
 190              		.loc 1 43 26 is_stmt 1 discriminator 2 view .LVU52
 191              	.LVL17:
  43:.././simpleserial/simpleserial.c **** 	{
 192              		.loc 1 43 26 is_stmt 0 discriminator 2 view .LVU53
 193 0030 0134     		adds	r4, r4, #1
 194              	.LVL18:
  43:.././simpleserial/simpleserial.c **** 	{
 195              		.loc 1 43 26 discriminator 2 view .LVU54
 196 0032 0231     		adds	r1, r1, #2
 197 0034 E6E7     		b	.L9
 198              	.LVL19:
 199              	.L10:
 200              	.LBB4:
  50:.././simpleserial/simpleserial.c **** 			data_buf[i] = n_lo - 'A' + 10;
 201              		.loc 1 50 8 is_stmt 1 view .LVU55
  50:.././simpleserial/simpleserial.c **** 			data_buf[i] = n_lo - 'A' + 10;
 202              		.loc 1 50 10 is_stmt 0 view .LVU56
 203 0036 2E00     		movs	r6, r5
 204 0038 413E     		subs	r6, r6, #65
 205 003a 052E     		cmp	r6, #5
 206 003c 02D8     		bhi	.L12
  51:.././simpleserial/simpleserial.c **** 		else if(n_lo >= 'a' && n_lo <= 'f')
 207              		.loc 1 51 4 is_stmt 1 view .LVU57
  51:.././simpleserial/simpleserial.c **** 		else if(n_lo >= 'a' && n_lo <= 'f')
 208              		.loc 1 51 29 is_stmt 0 view .LVU58
 209 003e 373D     		subs	r5, r5, #55
 210              	.LVL20:
 211              	.L20:
  53:.././simpleserial/simpleserial.c **** 		else
 212              		.loc 1 53 16 view .LVU59
 213 0040 2570     		strb	r5, [r4]
 214              	.LVL21:
  53:.././simpleserial/simpleserial.c **** 		else
 215              		.loc 1 53 16 view .LVU60
 216 0042 ECE7     		b	.L11
 217              	.LVL22:
 218              	.L12:
  52:.././simpleserial/simpleserial.c **** 			data_buf[i] = n_lo - 'a' + 10;
 219              		.loc 1 52 8 is_stmt 1 view .LVU61
  52:.././simpleserial/simpleserial.c **** 			data_buf[i] = n_lo - 'a' + 10;
 220              		.loc 1 52 10 is_stmt 0 view .LVU62
 221 0044 2E00     		movs	r6, r5
 222 0046 613E     		subs	r6, r6, #97
 223 0048 052E     		cmp	r6, #5
 224 004a 01D9     		bls	.L13
 225              	.LVL23:
 226              	.L18:
  55:.././simpleserial/simpleserial.c **** 
 227              		.loc 1 55 11 view .LVU63
 228 004c 0120     		movs	r0, #1
 229              	.LVL24:
 230              	.L8:
  55:.././simpleserial/simpleserial.c **** 
 231              		.loc 1 55 11 view .LVU64
 232              	.LBE4:
 233              	.LBE7:
  68:.././simpleserial/simpleserial.c **** }
 234              		.loc 1 68 1 view .LVU65
 235              		@ sp needed
 236              	.LVL25:
 237              		.loc 1 68 1 view .LVU66
 238 004e 70BD     		pop	{r4, r5, r6, pc}
 239              	.LVL26:
 240              	.L13:
 241              	.LBB8:
 242              	.LBB5:
  53:.././simpleserial/simpleserial.c **** 		else
 243              		.loc 1 53 4 is_stmt 1 view .LVU67
  53:.././simpleserial/simpleserial.c **** 		else
 244              		.loc 1 53 29 is_stmt 0 view .LVU68
 245 0050 573D     		subs	r5, r5, #87
 246              	.LVL27:
  53:.././simpleserial/simpleserial.c **** 		else
 247              		.loc 1 53 29 view .LVU69
 248 0052 F5E7     		b	.L20
 249              	.LVL28:
 250              	.L15:
  59:.././simpleserial/simpleserial.c **** 			data_buf[i] |= (n_hi - 'A' + 10) << 4;
 251              		.loc 1 59 8 is_stmt 1 view .LVU70
  59:.././simpleserial/simpleserial.c **** 			data_buf[i] |= (n_hi - 'A' + 10) << 4;
 252              		.loc 1 59 10 is_stmt 0 view .LVU71
 253 0054 1D00     		movs	r5, r3
 254 0056 413D     		subs	r5, r5, #65
 255 0058 052D     		cmp	r5, #5
 256 005a 05D8     		bhi	.L17
  60:.././simpleserial/simpleserial.c **** 		else if(n_hi >= 'a' && n_hi <= 'f')
 257              		.loc 1 60 4 is_stmt 1 view .LVU72
  60:.././simpleserial/simpleserial.c **** 		else if(n_hi >= 'a' && n_hi <= 'f')
 258              		.loc 1 60 31 is_stmt 0 view .LVU73
 259 005c 373B     		subs	r3, r3, #55
 260              	.LVL29:
 261              	.L21:
  62:.././simpleserial/simpleserial.c **** 		else
 262              		.loc 1 62 16 view .LVU74
 263 005e 2578     		ldrb	r5, [r4]
  62:.././simpleserial/simpleserial.c **** 		else
 264              		.loc 1 62 37 view .LVU75
 265 0060 1B01     		lsls	r3, r3, #4
  62:.././simpleserial/simpleserial.c **** 		else
 266              		.loc 1 62 16 view .LVU76
 267 0062 2B43     		orrs	r3, r5
 268 0064 2370     		strb	r3, [r4]
 269 0066 E3E7     		b	.L16
 270              	.LVL30:
 271              	.L17:
  61:.././simpleserial/simpleserial.c **** 			data_buf[i] |= (n_hi - 'a' + 10) << 4;
 272              		.loc 1 61 8 is_stmt 1 view .LVU77
  61:.././simpleserial/simpleserial.c **** 			data_buf[i] |= (n_hi - 'a' + 10) << 4;
 273              		.loc 1 61 10 is_stmt 0 view .LVU78
 274 0068 1D00     		movs	r5, r3
 275 006a 613D     		subs	r5, r5, #97
 276 006c 052D     		cmp	r5, #5
 277 006e EDD8     		bhi	.L18
  62:.././simpleserial/simpleserial.c **** 		else
 278              		.loc 1 62 4 is_stmt 1 view .LVU79
  62:.././simpleserial/simpleserial.c **** 		else
 279              		.loc 1 62 31 is_stmt 0 view .LVU80
 280 0070 573B     		subs	r3, r3, #87
 281              	.LVL31:
  62:.././simpleserial/simpleserial.c **** 		else
 282              		.loc 1 62 31 view .LVU81
 283 0072 F4E7     		b	.L21
 284              	.LBE5:
 285              	.LBE8:
 286              		.cfi_endproc
 287              	.LFE1:
 289              		.section	.text.ss_puts,"ax",%progbits
 290              		.align	1
 291              		.global	ss_puts
 292              		.syntax unified
 293              		.code	16
 294              		.thumb_func
 295              		.fpu softvfp
 297              	ss_puts:
 298              	.LVL32:
 299              	.LFB2:
  69:.././simpleserial/simpleserial.c **** 
  70:.././simpleserial/simpleserial.c **** typedef struct ss_cmd
  71:.././simpleserial/simpleserial.c **** {
  72:.././simpleserial/simpleserial.c **** 	char c;
  73:.././simpleserial/simpleserial.c **** 	unsigned int len;
  74:.././simpleserial/simpleserial.c **** 	uint8_t (*fp)(uint8_t, uint8_t, uint8_t, uint8_t *);
  75:.././simpleserial/simpleserial.c **** } ss_cmd;
  76:.././simpleserial/simpleserial.c **** static ss_cmd commands[MAX_SS_CMDS];
  77:.././simpleserial/simpleserial.c **** 
  78:.././simpleserial/simpleserial.c **** void ss_puts(char *x)
  79:.././simpleserial/simpleserial.c **** {
 300              		.loc 1 79 1 is_stmt 1 view -0
 301              		.cfi_startproc
 302              		@ args = 0, pretend = 0, frame = 0
 303              		@ frame_needed = 0, uses_anonymous_args = 0
 304              		.loc 1 79 1 is_stmt 0 view .LVU83
 305 0000 10B5     		push	{r4, lr}
 306              	.LCFI2:
 307              		.cfi_def_cfa_offset 8
 308              		.cfi_offset 4, -8
 309              		.cfi_offset 14, -4
 310 0002 0400     		movs	r4, r0
 311              	.LVL33:
 312              	.L23:
  80:.././simpleserial/simpleserial.c **** 	do {
 313              		.loc 1 80 2 is_stmt 1 discriminator 1 view .LVU84
  81:.././simpleserial/simpleserial.c **** 		putch(*x);
 314              		.loc 1 81 3 discriminator 1 view .LVU85
 315 0004 2078     		ldrb	r0, [r4]
  82:.././simpleserial/simpleserial.c **** 	} while (*++x);
 316              		.loc 1 82 2 is_stmt 0 discriminator 1 view .LVU86
 317 0006 0134     		adds	r4, r4, #1
 318              	.LVL34:
  81:.././simpleserial/simpleserial.c **** 		putch(*x);
 319              		.loc 1 81 3 discriminator 1 view .LVU87
 320 0008 FFF7FEFF 		bl	putch
 321              	.LVL35:
 322              		.loc 1 82 10 is_stmt 1 discriminator 1 view .LVU88
 323              		.loc 1 82 2 is_stmt 0 discriminator 1 view .LVU89
 324 000c 2378     		ldrb	r3, [r4]
 325 000e 002B     		cmp	r3, #0
 326 0010 F8D1     		bne	.L23
  83:.././simpleserial/simpleserial.c **** }
 327              		.loc 1 83 1 view .LVU90
 328              		@ sp needed
 329              	.LVL36:
 330              		.loc 1 83 1 view .LVU91
 331 0012 10BD     		pop	{r4, pc}
 332              		.cfi_endproc
 333              	.LFE2:
 335              		.section	.text.stuff_data,"ax",%progbits
 336              		.align	1
 337              		.global	stuff_data
 338              		.syntax unified
 339              		.code	16
 340              		.thumb_func
 341              		.fpu softvfp
 343              	stuff_data:
 344              	.LVL37:
 345              	.LFB5:
  84:.././simpleserial/simpleserial.c **** 
  85:.././simpleserial/simpleserial.c **** #define FRAME_BYTE 0x00
  86:.././simpleserial/simpleserial.c **** 
  87:.././simpleserial/simpleserial.c **** uint8_t check_version(uint8_t cmd, uint8_t scmd, uint8_t len, uint8_t *data)
  88:.././simpleserial/simpleserial.c **** {
  89:.././simpleserial/simpleserial.c **** 	uint8_t ver = SS_VER;
  90:.././simpleserial/simpleserial.c **** 	simpleserial_put('r', 1, &ver);
  91:.././simpleserial/simpleserial.c **** 	return SS_ERR_OK;
  92:.././simpleserial/simpleserial.c **** }
  93:.././simpleserial/simpleserial.c **** 
  94:.././simpleserial/simpleserial.c **** uint8_t ss_get_commands(uint8_t cmd, uint8_t scmd, uint8_t len, uint8_t *data)
  95:.././simpleserial/simpleserial.c **** {
  96:.././simpleserial/simpleserial.c ****     uint8_t cmd_chars[MAX_SS_CMDS];
  97:.././simpleserial/simpleserial.c ****     for (uint8_t i = 0; i < (num_commands & 0xFF); i++) {
  98:.././simpleserial/simpleserial.c ****         cmd_chars[i] = commands[i].c;
  99:.././simpleserial/simpleserial.c ****     }
 100:.././simpleserial/simpleserial.c **** 
 101:.././simpleserial/simpleserial.c ****     simpleserial_put('r', num_commands & 0xFF, (void *)cmd_chars);
 102:.././simpleserial/simpleserial.c ****     return 0x00;
 103:.././simpleserial/simpleserial.c **** 
 104:.././simpleserial/simpleserial.c **** }
 105:.././simpleserial/simpleserial.c **** 
 106:.././simpleserial/simpleserial.c **** uint8_t stuff_data(uint8_t *buf, uint8_t len)
 107:.././simpleserial/simpleserial.c **** {
 346              		.loc 1 107 1 is_stmt 1 view -0
 347              		.cfi_startproc
 348              		@ args = 0, pretend = 0, frame = 0
 349              		@ frame_needed = 0, uses_anonymous_args = 0
 108:.././simpleserial/simpleserial.c **** 	uint8_t i = 1;
 350              		.loc 1 108 2 view .LVU93
 109:.././simpleserial/simpleserial.c **** 	uint8_t last = 0;
 351              		.loc 1 109 2 view .LVU94
 110:.././simpleserial/simpleserial.c **** 	for (; i < len; i++) {
 352              		.loc 1 110 2 view .LVU95
 109:.././simpleserial/simpleserial.c **** 	uint8_t last = 0;
 353              		.loc 1 109 10 is_stmt 0 view .LVU96
 354 0000 0022     		movs	r2, #0
 108:.././simpleserial/simpleserial.c **** 	uint8_t i = 1;
 355              		.loc 1 108 10 view .LVU97
 356 0002 0123     		movs	r3, #1
 107:.././simpleserial/simpleserial.c **** 	uint8_t i = 1;
 357              		.loc 1 107 1 view .LVU98
 358 0004 30B5     		push	{r4, r5, lr}
 359              	.LCFI3:
 360              		.cfi_def_cfa_offset 12
 361              		.cfi_offset 4, -12
 362              		.cfi_offset 5, -8
 363              		.cfi_offset 14, -4
 364 0006 441C     		adds	r4, r0, #1
 365              	.LVL38:
 366              	.L26:
 367              		.loc 1 110 9 is_stmt 1 discriminator 1 view .LVU99
 368              		.loc 1 110 2 is_stmt 0 discriminator 1 view .LVU100
 369 0008 8B42     		cmp	r3, r1
 370 000a 01D3     		bcc	.L28
 111:.././simpleserial/simpleserial.c **** 		if (buf[i] == FRAME_BYTE) {
 112:.././simpleserial/simpleserial.c **** 			buf[last] = i - last;
 113:.././simpleserial/simpleserial.c **** 			last = i;
 114:.././simpleserial/simpleserial.c **** 		}
 115:.././simpleserial/simpleserial.c **** 	}
 116:.././simpleserial/simpleserial.c **** 	return 0x00;
 371              		.loc 1 116 2 is_stmt 1 view .LVU101
 117:.././simpleserial/simpleserial.c **** }
 372              		.loc 1 117 1 is_stmt 0 view .LVU102
 373              		@ sp needed
 374 000c 0020     		movs	r0, #0
 375              	.LVL39:
 376              		.loc 1 117 1 view .LVU103
 377 000e 30BD     		pop	{r4, r5, pc}
 378              	.LVL40:
 379              	.L28:
 111:.././simpleserial/simpleserial.c **** 		if (buf[i] == FRAME_BYTE) {
 380              		.loc 1 111 3 is_stmt 1 view .LVU104
 111:.././simpleserial/simpleserial.c **** 		if (buf[i] == FRAME_BYTE) {
 381              		.loc 1 111 6 is_stmt 0 view .LVU105
 382 0010 2578     		ldrb	r5, [r4]
 383 0012 002D     		cmp	r5, #0
 384 0014 02D1     		bne	.L27
 112:.././simpleserial/simpleserial.c **** 			last = i;
 385              		.loc 1 112 4 is_stmt 1 view .LVU106
 112:.././simpleserial/simpleserial.c **** 			last = i;
 386              		.loc 1 112 18 is_stmt 0 view .LVU107
 387 0016 9D1A     		subs	r5, r3, r2
 112:.././simpleserial/simpleserial.c **** 			last = i;
 388              		.loc 1 112 14 view .LVU108
 389 0018 8554     		strb	r5, [r0, r2]
 113:.././simpleserial/simpleserial.c **** 		}
 390              		.loc 1 113 4 is_stmt 1 view .LVU109
 391              	.LVL41:
 112:.././simpleserial/simpleserial.c **** 			last = i;
 392              		.loc 1 112 14 is_stmt 0 view .LVU110
 393 001a 1A00     		movs	r2, r3
 394              	.LVL42:
 395              	.L27:
 110:.././simpleserial/simpleserial.c **** 		if (buf[i] == FRAME_BYTE) {
 396              		.loc 1 110 18 is_stmt 1 view .LVU111
 110:.././simpleserial/simpleserial.c **** 		if (buf[i] == FRAME_BYTE) {
 397              		.loc 1 110 19 is_stmt 0 view .LVU112
 398 001c 0133     		adds	r3, r3, #1
 399              	.LVL43:
 110:.././simpleserial/simpleserial.c **** 		if (buf[i] == FRAME_BYTE) {
 400              		.loc 1 110 19 view .LVU113
 401 001e DBB2     		uxtb	r3, r3
 402              	.LVL44:
 110:.././simpleserial/simpleserial.c **** 		if (buf[i] == FRAME_BYTE) {
 403              		.loc 1 110 19 view .LVU114
 404 0020 0134     		adds	r4, r4, #1
 405 0022 F1E7     		b	.L26
 406              		.cfi_endproc
 407              	.LFE5:
 409              		.section	.text.unstuff_data,"ax",%progbits
 410              		.align	1
 411              		.global	unstuff_data
 412              		.syntax unified
 413              		.code	16
 414              		.thumb_func
 415              		.fpu softvfp
 417              	unstuff_data:
 418              	.LVL45:
 419              	.LFB6:
 118:.././simpleserial/simpleserial.c **** 
 119:.././simpleserial/simpleserial.c **** uint8_t unstuff_data(uint8_t *buf, uint8_t len)
 120:.././simpleserial/simpleserial.c **** {
 420              		.loc 1 120 1 is_stmt 1 view -0
 421              		.cfi_startproc
 422              		@ args = 0, pretend = 0, frame = 0
 423              		@ frame_needed = 0, uses_anonymous_args = 0
 121:.././simpleserial/simpleserial.c **** 	uint8_t next = buf[0];
 424              		.loc 1 121 2 view .LVU116
 120:.././simpleserial/simpleserial.c **** 	uint8_t next = buf[0];
 425              		.loc 1 120 1 is_stmt 0 view .LVU117
 426 0000 30B5     		push	{r4, r5, lr}
 427              	.LCFI4:
 428              		.cfi_def_cfa_offset 12
 429              		.cfi_offset 4, -12
 430              		.cfi_offset 5, -8
 431              		.cfi_offset 14, -4
 122:.././simpleserial/simpleserial.c **** 	buf[0] = 0x00;
 432              		.loc 1 122 9 view .LVU118
 433 0002 0024     		movs	r4, #0
 121:.././simpleserial/simpleserial.c **** 	uint8_t next = buf[0];
 434              		.loc 1 121 10 view .LVU119
 435 0004 0278     		ldrb	r2, [r0]
 436              	.LVL46:
 437              		.loc 1 122 2 is_stmt 1 view .LVU120
 120:.././simpleserial/simpleserial.c **** 	uint8_t next = buf[0];
 438              		.loc 1 120 1 is_stmt 0 view .LVU121
 439 0006 0300     		movs	r3, r0
 440              		.loc 1 122 9 view .LVU122
 441 0008 0470     		strb	r4, [r0]
 123:.././simpleserial/simpleserial.c **** 	//len -= 1;
 124:.././simpleserial/simpleserial.c **** 	uint8_t tmp = next;
 442              		.loc 1 124 2 is_stmt 1 view .LVU123
 443              	.LVL47:
 125:.././simpleserial/simpleserial.c **** 	while ((next < len) && tmp != 0) {
 444              		.loc 1 125 2 view .LVU124
 121:.././simpleserial/simpleserial.c **** 	buf[0] = 0x00;
 445              		.loc 1 121 10 is_stmt 0 view .LVU125
 446 000a 1000     		movs	r0, r2
 447              	.LVL48:
 448              	.L30:
 449              		.loc 1 125 8 is_stmt 1 view .LVU126
 450 000c 8842     		cmp	r0, r1
 451 000e 01D2     		bcs	.L34
 452              		.loc 1 125 22 is_stmt 0 discriminator 1 view .LVU127
 453 0010 002A     		cmp	r2, #0
 454 0012 00D1     		bne	.L32
 455              	.L34:
 126:.././simpleserial/simpleserial.c **** 		tmp = buf[next];
 127:.././simpleserial/simpleserial.c **** 		buf[next] = FRAME_BYTE;
 128:.././simpleserial/simpleserial.c **** 		next += tmp;
 129:.././simpleserial/simpleserial.c **** 	}
 130:.././simpleserial/simpleserial.c **** 	return next;
 131:.././simpleserial/simpleserial.c **** }
 456              		.loc 1 131 1 view .LVU128
 457              		@ sp needed
 458 0014 30BD     		pop	{r4, r5, pc}
 459              	.L32:
 126:.././simpleserial/simpleserial.c **** 		tmp = buf[next];
 460              		.loc 1 126 3 is_stmt 1 view .LVU129
 126:.././simpleserial/simpleserial.c **** 		tmp = buf[next];
 461              		.loc 1 126 7 is_stmt 0 view .LVU130
 462 0016 1A5C     		ldrb	r2, [r3, r0]
 463              	.LVL49:
 127:.././simpleserial/simpleserial.c **** 		next += tmp;
 464              		.loc 1 127 3 is_stmt 1 view .LVU131
 126:.././simpleserial/simpleserial.c **** 		tmp = buf[next];
 465              		.loc 1 126 12 is_stmt 0 view .LVU132
 466 0018 1D18     		adds	r5, r3, r0
 128:.././simpleserial/simpleserial.c **** 	}
 467              		.loc 1 128 8 view .LVU133
 468 001a 8018     		adds	r0, r0, r2
 469              	.LVL50:
 127:.././simpleserial/simpleserial.c **** 		next += tmp;
 470              		.loc 1 127 13 view .LVU134
 471 001c 2C70     		strb	r4, [r5]
 128:.././simpleserial/simpleserial.c **** 	}
 472              		.loc 1 128 3 is_stmt 1 view .LVU135
 128:.././simpleserial/simpleserial.c **** 	}
 473              		.loc 1 128 8 is_stmt 0 view .LVU136
 474 001e C0B2     		uxtb	r0, r0
 475              	.LVL51:
 128:.././simpleserial/simpleserial.c **** 	}
 476              		.loc 1 128 8 view .LVU137
 477 0020 F4E7     		b	.L30
 478              		.cfi_endproc
 479              	.LFE6:
 481              		.section	.text.simpleserial_addcmd,"ax",%progbits
 482              		.align	1
 483              		.global	simpleserial_addcmd
 484              		.syntax unified
 485              		.code	16
 486              		.thumb_func
 487              		.fpu softvfp
 489              	simpleserial_addcmd:
 490              	.LVL52:
 491              	.LFB8:
 132:.././simpleserial/simpleserial.c **** 
 133:.././simpleserial/simpleserial.c **** // Set up the SimpleSerial module by preparing internal commands
 134:.././simpleserial/simpleserial.c **** // This just adds the "v" command for now...
 135:.././simpleserial/simpleserial.c **** void simpleserial_init()
 136:.././simpleserial/simpleserial.c **** {
 137:.././simpleserial/simpleserial.c **** 	simpleserial_addcmd('v', 0, check_version);
 138:.././simpleserial/simpleserial.c ****     simpleserial_addcmd('w', 0, ss_get_commands);
 139:.././simpleserial/simpleserial.c **** }
 140:.././simpleserial/simpleserial.c **** 
 141:.././simpleserial/simpleserial.c **** int simpleserial_addcmd(char c, unsigned int len, uint8_t (*fp)(uint8_t, uint8_t, uint8_t, uint8_t*
 142:.././simpleserial/simpleserial.c **** {
 492              		.loc 1 142 1 is_stmt 1 view -0
 493              		.cfi_startproc
 494              		@ args = 0, pretend = 0, frame = 0
 495              		@ frame_needed = 0, uses_anonymous_args = 0
 143:.././simpleserial/simpleserial.c **** 	if(num_commands >= MAX_SS_CMDS) {
 496              		.loc 1 143 2 view .LVU139
 142:.././simpleserial/simpleserial.c **** 	if(num_commands >= MAX_SS_CMDS) {
 497              		.loc 1 142 1 is_stmt 0 view .LVU140
 498 0000 70B5     		push	{r4, r5, r6, lr}
 499              	.LCFI5:
 500              		.cfi_def_cfa_offset 16
 501              		.cfi_offset 4, -16
 502              		.cfi_offset 5, -12
 503              		.cfi_offset 6, -8
 504              		.cfi_offset 14, -4
 505              		.loc 1 143 18 view .LVU141
 506 0002 0C4E     		ldr	r6, .L40
 142:.././simpleserial/simpleserial.c **** 	if(num_commands >= MAX_SS_CMDS) {
 507              		.loc 1 142 1 view .LVU142
 508 0004 0500     		movs	r5, r0
 509              		.loc 1 143 18 view .LVU143
 510 0006 3368     		ldr	r3, [r6]
 144:.././simpleserial/simpleserial.c **** 		putch('a');
 511              		.loc 1 144 3 view .LVU144
 512 0008 6120     		movs	r0, #97
 513              	.LVL53:
 143:.././simpleserial/simpleserial.c **** 	if(num_commands >= MAX_SS_CMDS) {
 514              		.loc 1 143 4 view .LVU145
 515 000a 0F2B     		cmp	r3, #15
 516 000c 02DC     		bgt	.L39
 145:.././simpleserial/simpleserial.c **** 		return 1;
 146:.././simpleserial/simpleserial.c **** 	}
 147:.././simpleserial/simpleserial.c **** 
 148:.././simpleserial/simpleserial.c **** 	if(len >= MAX_SS_LEN) {
 517              		.loc 1 148 2 is_stmt 1 view .LVU146
 518              		.loc 1 148 4 is_stmt 0 view .LVU147
 519 000e FF29     		cmp	r1, #255
 520 0010 04D9     		bls	.L38
 149:.././simpleserial/simpleserial.c **** 		putch('b');
 521              		.loc 1 149 3 is_stmt 1 view .LVU148
 522 0012 6220     		movs	r0, #98
 523              	.L39:
 524 0014 FFF7FEFF 		bl	putch
 525              	.LVL54:
 150:.././simpleserial/simpleserial.c **** 		return 1;
 526              		.loc 1 150 3 view .LVU149
 527              		.loc 1 150 10 is_stmt 0 view .LVU150
 528 0018 0120     		movs	r0, #1
 529              	.L35:
 151:.././simpleserial/simpleserial.c **** 	}
 152:.././simpleserial/simpleserial.c **** 
 153:.././simpleserial/simpleserial.c **** 	commands[num_commands].c   = c;
 154:.././simpleserial/simpleserial.c **** 	commands[num_commands].len = len;
 155:.././simpleserial/simpleserial.c **** 	commands[num_commands].fp  = fp;
 156:.././simpleserial/simpleserial.c **** 	num_commands++;
 157:.././simpleserial/simpleserial.c **** 
 158:.././simpleserial/simpleserial.c **** 	return 0;
 159:.././simpleserial/simpleserial.c **** }
 530              		.loc 1 159 1 view .LVU151
 531              		@ sp needed
 532 001a 70BD     		pop	{r4, r5, r6, pc}
 533              	.LVL55:
 534              	.L38:
 153:.././simpleserial/simpleserial.c **** 	commands[num_commands].len = len;
 535              		.loc 1 153 2 is_stmt 1 view .LVU152
 153:.././simpleserial/simpleserial.c **** 	commands[num_commands].len = len;
 536              		.loc 1 153 29 is_stmt 0 view .LVU153
 537 001c 0C24     		movs	r4, #12
 538 001e 5C43     		muls	r4, r3
 539 0020 0548     		ldr	r0, .L40+4
 156:.././simpleserial/simpleserial.c **** 
 540              		.loc 1 156 14 view .LVU154
 541 0022 0133     		adds	r3, r3, #1
 153:.././simpleserial/simpleserial.c **** 	commands[num_commands].len = len;
 542              		.loc 1 153 29 view .LVU155
 543 0024 2554     		strb	r5, [r4, r0]
 154:.././simpleserial/simpleserial.c **** 	commands[num_commands].fp  = fp;
 544              		.loc 1 154 2 is_stmt 1 view .LVU156
 154:.././simpleserial/simpleserial.c **** 	commands[num_commands].fp  = fp;
 545              		.loc 1 154 29 is_stmt 0 view .LVU157
 546 0026 0019     		adds	r0, r0, r4
 547 0028 4160     		str	r1, [r0, #4]
 155:.././simpleserial/simpleserial.c **** 	num_commands++;
 548              		.loc 1 155 2 is_stmt 1 view .LVU158
 155:.././simpleserial/simpleserial.c **** 	num_commands++;
 549              		.loc 1 155 29 is_stmt 0 view .LVU159
 550 002a 8260     		str	r2, [r0, #8]
 156:.././simpleserial/simpleserial.c **** 
 551              		.loc 1 156 2 is_stmt 1 view .LVU160
 156:.././simpleserial/simpleserial.c **** 
 552              		.loc 1 156 14 is_stmt 0 view .LVU161
 553 002c 3360     		str	r3, [r6]
 158:.././simpleserial/simpleserial.c **** }
 554              		.loc 1 158 2 is_stmt 1 view .LVU162
 158:.././simpleserial/simpleserial.c **** }
 555              		.loc 1 158 9 is_stmt 0 view .LVU163
 556 002e 0020     		movs	r0, #0
 557 0030 F3E7     		b	.L35
 558              	.L41:
 559 0032 C046     		.align	2
 560              	.L40:
 561 0034 00000000 		.word	.LANCHOR0
 562 0038 04000000 		.word	commands
 563              		.cfi_endproc
 564              	.LFE8:
 566              		.section	.text.simpleserial_init,"ax",%progbits
 567              		.align	1
 568              		.global	simpleserial_init
 569              		.syntax unified
 570              		.code	16
 571              		.thumb_func
 572              		.fpu softvfp
 574              	simpleserial_init:
 575              	.LFB7:
 136:.././simpleserial/simpleserial.c **** 	simpleserial_addcmd('v', 0, check_version);
 576              		.loc 1 136 1 is_stmt 1 view -0
 577              		.cfi_startproc
 578              		@ args = 0, pretend = 0, frame = 0
 579              		@ frame_needed = 0, uses_anonymous_args = 0
 137:.././simpleserial/simpleserial.c ****     simpleserial_addcmd('w', 0, ss_get_commands);
 580              		.loc 1 137 2 view .LVU165
 136:.././simpleserial/simpleserial.c **** 	simpleserial_addcmd('v', 0, check_version);
 581              		.loc 1 136 1 is_stmt 0 view .LVU166
 582 0000 10B5     		push	{r4, lr}
 583              	.LCFI6:
 584              		.cfi_def_cfa_offset 8
 585              		.cfi_offset 4, -8
 586              		.cfi_offset 14, -4
 137:.././simpleserial/simpleserial.c ****     simpleserial_addcmd('w', 0, ss_get_commands);
 587              		.loc 1 137 2 view .LVU167
 588 0002 0021     		movs	r1, #0
 139:.././simpleserial/simpleserial.c **** 
 589              		.loc 1 139 1 view .LVU168
 590              		@ sp needed
 137:.././simpleserial/simpleserial.c ****     simpleserial_addcmd('w', 0, ss_get_commands);
 591              		.loc 1 137 2 view .LVU169
 592 0004 044A     		ldr	r2, .L43
 593 0006 7620     		movs	r0, #118
 594 0008 FFF7FEFF 		bl	simpleserial_addcmd
 595              	.LVL56:
 138:.././simpleserial/simpleserial.c **** }
 596              		.loc 1 138 5 is_stmt 1 view .LVU170
 597 000c 0021     		movs	r1, #0
 598 000e 7720     		movs	r0, #119
 599 0010 024A     		ldr	r2, .L43+4
 600 0012 FFF7FEFF 		bl	simpleserial_addcmd
 601              	.LVL57:
 139:.././simpleserial/simpleserial.c **** 
 602              		.loc 1 139 1 is_stmt 0 view .LVU171
 603 0016 10BD     		pop	{r4, pc}
 604              	.L44:
 605              		.align	2
 606              	.L43:
 607 0018 00000000 		.word	check_version
 608 001c 00000000 		.word	ss_get_commands
 609              		.cfi_endproc
 610              	.LFE7:
 612              		.section	.text.simpleserial_put,"ax",%progbits
 613              		.align	1
 614              		.global	simpleserial_put
 615              		.syntax unified
 616              		.code	16
 617              		.thumb_func
 618              		.fpu softvfp
 620              	simpleserial_put:
 621              	.LVL58:
 622              	.LFB10:
 160:.././simpleserial/simpleserial.c **** 
 161:.././simpleserial/simpleserial.c **** void simpleserial_get(void)
 162:.././simpleserial/simpleserial.c **** {
 163:.././simpleserial/simpleserial.c **** 	uint8_t data_buf[MAX_SS_LEN];
 164:.././simpleserial/simpleserial.c **** 	uint8_t err = 0;
 165:.././simpleserial/simpleserial.c **** 
 166:.././simpleserial/simpleserial.c **** 	for (int i = 0; i < 4; i++) {
 167:.././simpleserial/simpleserial.c **** 		data_buf[i] = getch(); //PTR, cmd, scmd, len
 168:.././simpleserial/simpleserial.c **** 		if (data_buf[i] == FRAME_BYTE) {
 169:.././simpleserial/simpleserial.c **** 			err = SS_ERR_FRAME_BYTE;
 170:.././simpleserial/simpleserial.c **** 			goto ERROR;
 171:.././simpleserial/simpleserial.c **** 		}
 172:.././simpleserial/simpleserial.c **** 	}
 173:.././simpleserial/simpleserial.c **** 	uint8_t next_frame = unstuff_data(data_buf, 4);
 174:.././simpleserial/simpleserial.c **** 
 175:.././simpleserial/simpleserial.c **** 	// check for valid command
 176:.././simpleserial/simpleserial.c **** 	uint8_t c = 0;
 177:.././simpleserial/simpleserial.c **** 	for(c = 0; c < num_commands; c++)
 178:.././simpleserial/simpleserial.c **** 	{
 179:.././simpleserial/simpleserial.c **** 		if(commands[c].c == data_buf[1])
 180:.././simpleserial/simpleserial.c **** 			break;
 181:.././simpleserial/simpleserial.c **** 	}
 182:.././simpleserial/simpleserial.c **** 
 183:.././simpleserial/simpleserial.c **** 	if (c == num_commands) {
 184:.././simpleserial/simpleserial.c **** 		err = SS_ERR_CMD;
 185:.././simpleserial/simpleserial.c **** 		goto ERROR;
 186:.././simpleserial/simpleserial.c **** 	}
 187:.././simpleserial/simpleserial.c **** 
 188:.././simpleserial/simpleserial.c **** 	//check that next frame not beyond end of message
 189:.././simpleserial/simpleserial.c **** 	// account for cmd, scmd, len, data, crc, end of frame
 190:.././simpleserial/simpleserial.c **** 	if ((data_buf[3] + 5) < next_frame) {
 191:.././simpleserial/simpleserial.c **** 		err = SS_ERR_LEN;
 192:.././simpleserial/simpleserial.c **** 		goto ERROR;
 193:.././simpleserial/simpleserial.c **** 	}
 194:.././simpleserial/simpleserial.c **** 
 195:.././simpleserial/simpleserial.c **** 	// read in data
 196:.././simpleserial/simpleserial.c **** 	// eq to len + crc + frame end
 197:.././simpleserial/simpleserial.c **** 	int i = 4;
 198:.././simpleserial/simpleserial.c **** 	for (; i < data_buf[3] + 5; i++) {
 199:.././simpleserial/simpleserial.c **** 		data_buf[i] = getch();
 200:.././simpleserial/simpleserial.c **** 		if (data_buf[i] == FRAME_BYTE) {
 201:.././simpleserial/simpleserial.c **** 			err = SS_ERR_FRAME_BYTE;
 202:.././simpleserial/simpleserial.c **** 			goto ERROR;
 203:.././simpleserial/simpleserial.c **** 		}
 204:.././simpleserial/simpleserial.c **** 	}
 205:.././simpleserial/simpleserial.c **** 
 206:.././simpleserial/simpleserial.c **** 	//check that final byte is the FRAME_BYTE
 207:.././simpleserial/simpleserial.c **** 	data_buf[i] = getch();
 208:.././simpleserial/simpleserial.c **** 	if (data_buf[i] != FRAME_BYTE) {
 209:.././simpleserial/simpleserial.c **** 		err = SS_ERR_LEN;
 210:.././simpleserial/simpleserial.c **** 		goto ERROR;
 211:.././simpleserial/simpleserial.c **** 	}
 212:.././simpleserial/simpleserial.c **** 
 213:.././simpleserial/simpleserial.c **** 	//fully unstuff data now
 214:.././simpleserial/simpleserial.c **** 	unstuff_data(data_buf + next_frame, i - next_frame + 1);
 215:.././simpleserial/simpleserial.c **** 
 216:.././simpleserial/simpleserial.c **** 	//calc crc excluding original frame offset and frame end and crc
 217:.././simpleserial/simpleserial.c **** 	uint8_t crc = ss_crc(data_buf+1, i-2);
 218:.././simpleserial/simpleserial.c **** 	if (crc != data_buf[i-1]) {
 219:.././simpleserial/simpleserial.c **** 		err = SS_ERR_CRC;
 220:.././simpleserial/simpleserial.c **** 		goto ERROR;
 221:.././simpleserial/simpleserial.c **** 	}
 222:.././simpleserial/simpleserial.c **** 
 223:.././simpleserial/simpleserial.c **** 	err = commands[c].fp(data_buf[1], data_buf[2], data_buf[3], data_buf+4);
 224:.././simpleserial/simpleserial.c **** 
 225:.././simpleserial/simpleserial.c **** ERROR:
 226:.././simpleserial/simpleserial.c **** 	simpleserial_put('e', 0x01, &err);
 227:.././simpleserial/simpleserial.c **** 	return;
 228:.././simpleserial/simpleserial.c **** }
 229:.././simpleserial/simpleserial.c **** 
 230:.././simpleserial/simpleserial.c **** void simpleserial_put(char c, uint8_t size, uint8_t* output)
 231:.././simpleserial/simpleserial.c **** {
 623              		.loc 1 231 1 is_stmt 1 view -0
 624              		.cfi_startproc
 625              		@ args = 0, pretend = 0, frame = 256
 626              		@ frame_needed = 0, uses_anonymous_args = 0
 232:.././simpleserial/simpleserial.c **** 	uint8_t data_buf[MAX_SS_LEN];
 627              		.loc 1 232 2 view .LVU173
 233:.././simpleserial/simpleserial.c **** 	data_buf[0] = 0x00;
 628              		.loc 1 233 2 view .LVU174
 231:.././simpleserial/simpleserial.c **** 	uint8_t data_buf[MAX_SS_LEN];
 629              		.loc 1 231 1 is_stmt 0 view .LVU175
 630 0000 70B5     		push	{r4, r5, r6, lr}
 631              	.LCFI7:
 632              		.cfi_def_cfa_offset 16
 633              		.cfi_offset 4, -16
 634              		.cfi_offset 5, -12
 635              		.cfi_offset 6, -8
 636              		.cfi_offset 14, -4
 637 0002 C0B0     		sub	sp, sp, #256
 638              	.LCFI8:
 639              		.cfi_def_cfa_offset 272
 231:.././simpleserial/simpleserial.c **** 	uint8_t data_buf[MAX_SS_LEN];
 640              		.loc 1 231 1 view .LVU176
 641 0004 0C00     		movs	r4, r1
 642              		.loc 1 233 14 view .LVU177
 643 0006 6B46     		mov	r3, sp
 644 0008 0025     		movs	r5, #0
 231:.././simpleserial/simpleserial.c **** 	uint8_t data_buf[MAX_SS_LEN];
 645              		.loc 1 231 1 view .LVU178
 646 000a 1100     		movs	r1, r2
 647              	.LVL59:
 234:.././simpleserial/simpleserial.c **** 	data_buf[1] = c;
 648              		.loc 1 234 14 view .LVU179
 649 000c 5870     		strb	r0, [r3, #1]
 235:.././simpleserial/simpleserial.c **** 	data_buf[2] = size;
 236:.././simpleserial/simpleserial.c **** 	int i = 0;
 237:.././simpleserial/simpleserial.c **** 	for (; i < size; i++) {
 238:.././simpleserial/simpleserial.c **** 		data_buf[i + 3] = output[i];
 650              		.loc 1 238 19 view .LVU180
 651 000e 2200     		movs	r2, r4
 652              	.LVL60:
 235:.././simpleserial/simpleserial.c **** 	data_buf[2] = size;
 653              		.loc 1 235 14 view .LVU181
 654 0010 9C70     		strb	r4, [r3, #2]
 233:.././simpleserial/simpleserial.c **** 	data_buf[1] = c;
 655              		.loc 1 233 14 view .LVU182
 656 0012 1D70     		strb	r5, [r3]
 234:.././simpleserial/simpleserial.c **** 	data_buf[1] = c;
 657              		.loc 1 234 2 is_stmt 1 view .LVU183
 235:.././simpleserial/simpleserial.c **** 	data_buf[2] = size;
 658              		.loc 1 235 2 view .LVU184
 236:.././simpleserial/simpleserial.c **** 	for (; i < size; i++) {
 659              		.loc 1 236 2 view .LVU185
 660              	.LVL61:
 237:.././simpleserial/simpleserial.c **** 		data_buf[i + 3] = output[i];
 661              		.loc 1 237 2 view .LVU186
 662              		.loc 1 238 19 is_stmt 0 view .LVU187
 663 0014 D81C     		adds	r0, r3, #3
 664              	.LVL62:
 665              		.loc 1 238 19 view .LVU188
 666 0016 FFF7FEFF 		bl	memcpy
 667              	.LVL63:
 239:.././simpleserial/simpleserial.c **** 	}
 240:.././simpleserial/simpleserial.c **** 	data_buf[i + 3] = ss_crc(data_buf+1, size+2);
 668              		.loc 1 240 2 is_stmt 1 view .LVU189
 669              		.loc 1 240 20 is_stmt 0 view .LVU190
 670 001a 6B46     		mov	r3, sp
 671 001c A11C     		adds	r1, r4, #2
 672 001e C9B2     		uxtb	r1, r1
 673 0020 581C     		adds	r0, r3, #1
 674 0022 FFF7FEFF 		bl	ss_crc
 675              	.LVL64:
 676              		.loc 1 240 18 view .LVU191
 677 0026 2300     		movs	r3, r4
 678 0028 6B44     		add	r3, r3, sp
 679 002a D870     		strb	r0, [r3, #3]
 241:.././simpleserial/simpleserial.c **** 	data_buf[i + 4] = 0x00;
 680              		.loc 1 241 2 is_stmt 1 view .LVU192
 681              		.loc 1 241 18 is_stmt 0 view .LVU193
 682 002c 6B46     		mov	r3, sp
 683              		.loc 1 241 13 view .LVU194
 684 002e 261D     		adds	r6, r4, #4
 242:.././simpleserial/simpleserial.c **** 	stuff_data(data_buf, i + 5);
 685              		.loc 1 242 2 view .LVU195
 686 0030 0534     		adds	r4, r4, #5
 687 0032 6846     		mov	r0, sp
 241:.././simpleserial/simpleserial.c **** 	data_buf[i + 4] = 0x00;
 688              		.loc 1 241 18 view .LVU196
 689 0034 9D55     		strb	r5, [r3, r6]
 690              		.loc 1 242 2 is_stmt 1 view .LVU197
 691 0036 E1B2     		uxtb	r1, r4
 692 0038 FFF7FEFF 		bl	stuff_data
 693              	.LVL65:
 243:.././simpleserial/simpleserial.c **** 	for (int i = 0; i < size + 5; i++) {
 694              		.loc 1 243 2 view .LVU198
 695              	.LBB9:
 696              		.loc 1 243 7 view .LVU199
 697              		.loc 1 243 18 view .LVU200
 698              	.L46:
 244:.././simpleserial/simpleserial.c **** 		putch(data_buf[i]);
 699              		.loc 1 244 3 discriminator 3 view .LVU201
 700 003c 6B46     		mov	r3, sp
 701 003e 585D     		ldrb	r0, [r3, r5]
 243:.././simpleserial/simpleserial.c **** 	for (int i = 0; i < size + 5; i++) {
 702              		.loc 1 243 33 is_stmt 0 discriminator 3 view .LVU202
 703 0040 0135     		adds	r5, r5, #1
 704              	.LVL66:
 705              		.loc 1 244 3 discriminator 3 view .LVU203
 706 0042 FFF7FEFF 		bl	putch
 707              	.LVL67:
 243:.././simpleserial/simpleserial.c **** 	for (int i = 0; i < size + 5; i++) {
 708              		.loc 1 243 32 is_stmt 1 discriminator 3 view .LVU204
 243:.././simpleserial/simpleserial.c **** 	for (int i = 0; i < size + 5; i++) {
 709              		.loc 1 243 18 discriminator 3 view .LVU205
 243:.././simpleserial/simpleserial.c **** 	for (int i = 0; i < size + 5; i++) {
 710              		.loc 1 243 2 is_stmt 0 discriminator 3 view .LVU206
 711 0046 AE42     		cmp	r6, r5
 712 0048 F8DA     		bge	.L46
 713              	.LBE9:
 245:.././simpleserial/simpleserial.c **** 	}
 246:.././simpleserial/simpleserial.c **** }
 714              		.loc 1 246 1 view .LVU207
 715 004a 40B0     		add	sp, sp, #256
 716              		@ sp needed
 717              	.LVL68:
 718              		.loc 1 246 1 view .LVU208
 719 004c 70BD     		pop	{r4, r5, r6, pc}
 720              		.cfi_endproc
 721              	.LFE10:
 723              		.section	.text.check_version,"ax",%progbits
 724              		.align	1
 725              		.global	check_version
 726              		.syntax unified
 727              		.code	16
 728              		.thumb_func
 729              		.fpu softvfp
 731              	check_version:
 732              	.LVL69:
 733              	.LFB3:
  88:.././simpleserial/simpleserial.c **** 	uint8_t ver = SS_VER;
 734              		.loc 1 88 1 is_stmt 1 view -0
 735              		.cfi_startproc
 736              		@ args = 0, pretend = 0, frame = 8
 737              		@ frame_needed = 0, uses_anonymous_args = 0
  89:.././simpleserial/simpleserial.c **** 	simpleserial_put('r', 1, &ver);
 738              		.loc 1 89 2 view .LVU210
  88:.././simpleserial/simpleserial.c **** 	uint8_t ver = SS_VER;
 739              		.loc 1 88 1 is_stmt 0 view .LVU211
 740 0000 07B5     		push	{r0, r1, r2, lr}
 741              	.LCFI9:
 742              		.cfi_def_cfa_offset 16
 743              		.cfi_offset 0, -16
 744              		.cfi_offset 1, -12
 745              		.cfi_offset 2, -8
 746              		.cfi_offset 14, -4
  89:.././simpleserial/simpleserial.c **** 	simpleserial_put('r', 1, &ver);
 747              		.loc 1 89 10 view .LVU212
 748 0002 6B46     		mov	r3, sp
 749              	.LVL70:
  92:.././simpleserial/simpleserial.c **** 
 750              		.loc 1 92 1 view .LVU213
 751              		@ sp needed
  89:.././simpleserial/simpleserial.c **** 	simpleserial_put('r', 1, &ver);
 752              		.loc 1 89 10 view .LVU214
 753 0004 DA1D     		adds	r2, r3, #7
 754              	.LVL71:
  89:.././simpleserial/simpleserial.c **** 	simpleserial_put('r', 1, &ver);
 755              		.loc 1 89 10 view .LVU215
 756 0006 0323     		movs	r3, #3
  90:.././simpleserial/simpleserial.c **** 	return SS_ERR_OK;
 757              		.loc 1 90 2 view .LVU216
 758 0008 7220     		movs	r0, #114
 759              	.LVL72:
  90:.././simpleserial/simpleserial.c **** 	return SS_ERR_OK;
 760              		.loc 1 90 2 view .LVU217
 761 000a 0121     		movs	r1, #1
 762              	.LVL73:
  89:.././simpleserial/simpleserial.c **** 	simpleserial_put('r', 1, &ver);
 763              		.loc 1 89 10 view .LVU218
 764 000c 1370     		strb	r3, [r2]
  90:.././simpleserial/simpleserial.c **** 	return SS_ERR_OK;
 765              		.loc 1 90 2 is_stmt 1 view .LVU219
 766 000e FFF7FEFF 		bl	simpleserial_put
 767              	.LVL74:
  91:.././simpleserial/simpleserial.c **** }
 768              		.loc 1 91 2 view .LVU220
  92:.././simpleserial/simpleserial.c **** 
 769              		.loc 1 92 1 is_stmt 0 view .LVU221
 770 0012 0020     		movs	r0, #0
 771 0014 0EBD     		pop	{r1, r2, r3, pc}
 772              		.cfi_endproc
 773              	.LFE3:
 775              		.section	.text.ss_get_commands,"ax",%progbits
 776              		.align	1
 777              		.global	ss_get_commands
 778              		.syntax unified
 779              		.code	16
 780              		.thumb_func
 781              		.fpu softvfp
 783              	ss_get_commands:
 784              	.LVL75:
 785              	.LFB4:
  95:.././simpleserial/simpleserial.c ****     uint8_t cmd_chars[MAX_SS_CMDS];
 786              		.loc 1 95 1 is_stmt 1 view -0
 787              		.cfi_startproc
 788              		@ args = 0, pretend = 0, frame = 16
 789              		@ frame_needed = 0, uses_anonymous_args = 0
  96:.././simpleserial/simpleserial.c ****     for (uint8_t i = 0; i < (num_commands & 0xFF); i++) {
 790              		.loc 1 96 5 view .LVU223
  97:.././simpleserial/simpleserial.c ****         cmd_chars[i] = commands[i].c;
 791              		.loc 1 97 5 view .LVU224
 792              	.LBB10:
  97:.././simpleserial/simpleserial.c ****         cmd_chars[i] = commands[i].c;
 793              		.loc 1 97 10 view .LVU225
  97:.././simpleserial/simpleserial.c ****         cmd_chars[i] = commands[i].c;
 794              		.loc 1 97 10 is_stmt 0 view .LVU226
 795              	.LBE10:
  95:.././simpleserial/simpleserial.c ****     uint8_t cmd_chars[MAX_SS_CMDS];
 796              		.loc 1 95 1 view .LVU227
 797 0000 7FB5     		push	{r0, r1, r2, r3, r4, r5, r6, lr}
 798              	.LCFI10:
 799              		.cfi_def_cfa_offset 32
 800              		.cfi_offset 0, -32
 801              		.cfi_offset 1, -28
 802              		.cfi_offset 2, -24
 803              		.cfi_offset 3, -20
 804              		.cfi_offset 4, -16
 805              		.cfi_offset 5, -12
 806              		.cfi_offset 6, -8
 807              		.cfi_offset 14, -4
 808              	.LBB11:
  97:.././simpleserial/simpleserial.c ****         cmd_chars[i] = commands[i].c;
 809              		.loc 1 97 43 view .LVU228
 810 0002 0C4B     		ldr	r3, .L52
 811              	.LVL76:
  98:.././simpleserial/simpleserial.c ****     }
 812              		.loc 1 98 35 view .LVU229
 813 0004 0C24     		movs	r4, #12
  97:.././simpleserial/simpleserial.c ****         cmd_chars[i] = commands[i].c;
 814              		.loc 1 97 43 view .LVU230
 815 0006 1968     		ldr	r1, [r3]
 816              	.LVL77:
  97:.././simpleserial/simpleserial.c ****         cmd_chars[i] = commands[i].c;
 817              		.loc 1 97 18 view .LVU231
 818 0008 0023     		movs	r3, #0
  98:.././simpleserial/simpleserial.c ****     }
 819              		.loc 1 98 35 view .LVU232
 820 000a 0B48     		ldr	r0, .L52+4
 821              	.LVL78:
  97:.././simpleserial/simpleserial.c ****         cmd_chars[i] = commands[i].c;
 822              		.loc 1 97 43 view .LVU233
 823 000c CAB2     		uxtb	r2, r1
 824              	.LVL79:
 825              	.L50:
  97:.././simpleserial/simpleserial.c ****         cmd_chars[i] = commands[i].c;
 826              		.loc 1 97 25 is_stmt 1 discriminator 1 view .LVU234
  97:.././simpleserial/simpleserial.c ****         cmd_chars[i] = commands[i].c;
 827              		.loc 1 97 5 is_stmt 0 discriminator 1 view .LVU235
 828 000e 9342     		cmp	r3, r2
 829 0010 07DB     		blt	.L51
 830              	.LBE11:
 101:.././simpleserial/simpleserial.c ****     return 0x00;
 831              		.loc 1 101 5 is_stmt 1 view .LVU236
 832 0012 6A46     		mov	r2, sp
 833 0014 7220     		movs	r0, #114
 834 0016 C9B2     		uxtb	r1, r1
 835 0018 FFF7FEFF 		bl	simpleserial_put
 836              	.LVL80:
 102:.././simpleserial/simpleserial.c **** 
 837              		.loc 1 102 5 view .LVU237
 104:.././simpleserial/simpleserial.c **** 
 838              		.loc 1 104 1 is_stmt 0 view .LVU238
 839 001c 0020     		movs	r0, #0
 840 001e 04B0     		add	sp, sp, #16
 841              		@ sp needed
 842 0020 70BD     		pop	{r4, r5, r6, pc}
 843              	.LVL81:
 844              	.L51:
 845              	.LBB12:
  98:.././simpleserial/simpleserial.c ****     }
 846              		.loc 1 98 9 is_stmt 1 discriminator 3 view .LVU239
  98:.././simpleserial/simpleserial.c ****     }
 847              		.loc 1 98 35 is_stmt 0 discriminator 3 view .LVU240
 848 0022 2500     		movs	r5, r4
  98:.././simpleserial/simpleserial.c ****     }
 849              		.loc 1 98 22 discriminator 3 view .LVU241
 850 0024 6E46     		mov	r6, sp
  98:.././simpleserial/simpleserial.c ****     }
 851              		.loc 1 98 35 discriminator 3 view .LVU242
 852 0026 5D43     		muls	r5, r3
  98:.././simpleserial/simpleserial.c ****     }
 853              		.loc 1 98 22 discriminator 3 view .LVU243
 854 0028 2D5C     		ldrb	r5, [r5, r0]
 855 002a F554     		strb	r5, [r6, r3]
  97:.././simpleserial/simpleserial.c ****         cmd_chars[i] = commands[i].c;
 856              		.loc 1 97 52 is_stmt 1 discriminator 3 view .LVU244
  97:.././simpleserial/simpleserial.c ****         cmd_chars[i] = commands[i].c;
 857              		.loc 1 97 53 is_stmt 0 discriminator 3 view .LVU245
 858 002c 0133     		adds	r3, r3, #1
 859              	.LVL82:
  97:.././simpleserial/simpleserial.c ****         cmd_chars[i] = commands[i].c;
 860              		.loc 1 97 53 discriminator 3 view .LVU246
 861 002e DBB2     		uxtb	r3, r3
 862              	.LVL83:
  97:.././simpleserial/simpleserial.c ****         cmd_chars[i] = commands[i].c;
 863              		.loc 1 97 53 discriminator 3 view .LVU247
 864 0030 EDE7     		b	.L50
 865              	.L53:
 866 0032 C046     		.align	2
 867              	.L52:
 868 0034 00000000 		.word	.LANCHOR0
 869 0038 04000000 		.word	commands
 870              	.LBE12:
 871              		.cfi_endproc
 872              	.LFE4:
 874              		.section	.text.simpleserial_get,"ax",%progbits
 875              		.align	1
 876              		.global	simpleserial_get
 877              		.syntax unified
 878              		.code	16
 879              		.thumb_func
 880              		.fpu softvfp
 882              	simpleserial_get:
 883              	.LFB9:
 162:.././simpleserial/simpleserial.c **** 	uint8_t data_buf[MAX_SS_LEN];
 884              		.loc 1 162 1 is_stmt 1 view -0
 885              		.cfi_startproc
 886              		@ args = 0, pretend = 0, frame = 272
 887              		@ frame_needed = 0, uses_anonymous_args = 0
 163:.././simpleserial/simpleserial.c **** 	uint8_t err = 0;
 888              		.loc 1 163 2 view .LVU249
 164:.././simpleserial/simpleserial.c **** 
 889              		.loc 1 164 2 view .LVU250
 162:.././simpleserial/simpleserial.c **** 	uint8_t data_buf[MAX_SS_LEN];
 890              		.loc 1 162 1 is_stmt 0 view .LVU251
 891 0000 F0B5     		push	{r4, r5, r6, r7, lr}
 892              	.LCFI11:
 893              		.cfi_def_cfa_offset 20
 894              		.cfi_offset 4, -20
 895              		.cfi_offset 5, -16
 896              		.cfi_offset 6, -12
 897              		.cfi_offset 7, -8
 898              		.cfi_offset 14, -4
 164:.././simpleserial/simpleserial.c **** 
 899              		.loc 1 164 10 view .LVU252
 900 0002 0025     		movs	r5, #0
 162:.././simpleserial/simpleserial.c **** 	uint8_t data_buf[MAX_SS_LEN];
 901              		.loc 1 162 1 view .LVU253
 902 0004 C5B0     		sub	sp, sp, #276
 903              	.LCFI12:
 904              		.cfi_def_cfa_offset 296
 164:.././simpleserial/simpleserial.c **** 
 905              		.loc 1 164 10 view .LVU254
 906 0006 02AB     		add	r3, sp, #8
 907 0008 DF1D     		adds	r7, r3, #7
 908 000a 3D70     		strb	r5, [r7]
 166:.././simpleserial/simpleserial.c **** 		data_buf[i] = getch(); //PTR, cmd, scmd, len
 909              		.loc 1 166 2 is_stmt 1 view .LVU255
 910              	.LBB13:
 166:.././simpleserial/simpleserial.c **** 		data_buf[i] = getch(); //PTR, cmd, scmd, len
 911              		.loc 1 166 7 view .LVU256
 912              	.LVL84:
 166:.././simpleserial/simpleserial.c **** 		data_buf[i] = getch(); //PTR, cmd, scmd, len
 913              		.loc 1 166 18 view .LVU257
 914              	.L57:
 167:.././simpleserial/simpleserial.c **** 		if (data_buf[i] == FRAME_BYTE) {
 915              		.loc 1 167 3 view .LVU258
 167:.././simpleserial/simpleserial.c **** 		if (data_buf[i] == FRAME_BYTE) {
 916              		.loc 1 167 17 is_stmt 0 view .LVU259
 917 000c FFF7FEFF 		bl	getch
 918              	.LVL85:
 167:.././simpleserial/simpleserial.c **** 		if (data_buf[i] == FRAME_BYTE) {
 919              		.loc 1 167 15 view .LVU260
 920 0010 04AC     		add	r4, sp, #16
 921 0012 2855     		strb	r0, [r5, r4]
 168:.././simpleserial/simpleserial.c **** 			err = SS_ERR_FRAME_BYTE;
 922              		.loc 1 168 3 is_stmt 1 view .LVU261
 168:.././simpleserial/simpleserial.c **** 			err = SS_ERR_FRAME_BYTE;
 923              		.loc 1 168 6 is_stmt 0 view .LVU262
 924 0014 0028     		cmp	r0, #0
 925 0016 08D1     		bne	.L55
 926              	.LVL86:
 927              	.L62:
 169:.././simpleserial/simpleserial.c **** 			goto ERROR;
 928              		.loc 1 169 4 is_stmt 1 view .LVU263
 169:.././simpleserial/simpleserial.c **** 			goto ERROR;
 929              		.loc 1 169 8 is_stmt 0 view .LVU264
 930 0018 0523     		movs	r3, #5
 931              	.L71:
 932              	.LBE13:
 219:.././simpleserial/simpleserial.c **** 		goto ERROR;
 933              		.loc 1 219 7 view .LVU265
 934 001a 3B70     		strb	r3, [r7]
 220:.././simpleserial/simpleserial.c **** 	}
 935              		.loc 1 220 3 is_stmt 1 view .LVU266
 936              	.L56:
 226:.././simpleserial/simpleserial.c **** 	return;
 937              		.loc 1 226 2 view .LVU267
 938 001c 3A00     		movs	r2, r7
 939 001e 0121     		movs	r1, #1
 940 0020 6520     		movs	r0, #101
 941 0022 FFF7FEFF 		bl	simpleserial_put
 942              	.LVL87:
 227:.././simpleserial/simpleserial.c **** }
 943              		.loc 1 227 2 view .LVU268
 228:.././simpleserial/simpleserial.c **** 
 944              		.loc 1 228 1 is_stmt 0 view .LVU269
 945 0026 45B0     		add	sp, sp, #276
 946              		@ sp needed
 947 0028 F0BD     		pop	{r4, r5, r6, r7, pc}
 948              	.LVL88:
 949              	.L55:
 950              	.LBB14:
 166:.././simpleserial/simpleserial.c **** 		data_buf[i] = getch(); //PTR, cmd, scmd, len
 951              		.loc 1 166 25 is_stmt 1 discriminator 2 view .LVU270
 166:.././simpleserial/simpleserial.c **** 		data_buf[i] = getch(); //PTR, cmd, scmd, len
 952              		.loc 1 166 26 is_stmt 0 discriminator 2 view .LVU271
 953 002a 0135     		adds	r5, r5, #1
 954              	.LVL89:
 166:.././simpleserial/simpleserial.c **** 		data_buf[i] = getch(); //PTR, cmd, scmd, len
 955              		.loc 1 166 18 is_stmt 1 discriminator 2 view .LVU272
 166:.././simpleserial/simpleserial.c **** 		data_buf[i] = getch(); //PTR, cmd, scmd, len
 956              		.loc 1 166 2 is_stmt 0 discriminator 2 view .LVU273
 957 002c 042D     		cmp	r5, #4
 958 002e EDD1     		bne	.L57
 959              	.LBE14:
 173:.././simpleserial/simpleserial.c **** 
 960              		.loc 1 173 2 is_stmt 1 view .LVU274
 173:.././simpleserial/simpleserial.c **** 
 961              		.loc 1 173 23 is_stmt 0 view .LVU275
 962 0030 2900     		movs	r1, r5
 963 0032 2000     		movs	r0, r4
 964 0034 FFF7FEFF 		bl	unstuff_data
 965              	.LVL90:
 177:.././simpleserial/simpleserial.c **** 	{
 966              		.loc 1 177 8 view .LVU276
 967 0038 0021     		movs	r1, #0
 173:.././simpleserial/simpleserial.c **** 
 968              		.loc 1 173 23 view .LVU277
 969 003a 0190     		str	r0, [sp, #4]
 970              	.LVL91:
 176:.././simpleserial/simpleserial.c **** 	for(c = 0; c < num_commands; c++)
 971              		.loc 1 176 2 is_stmt 1 view .LVU278
 177:.././simpleserial/simpleserial.c **** 	{
 972              		.loc 1 177 2 view .LVU279
 179:.././simpleserial/simpleserial.c **** 			break;
 973              		.loc 1 179 17 is_stmt 0 view .LVU280
 974 003c 0C20     		movs	r0, #12
 177:.././simpleserial/simpleserial.c **** 	{
 975              		.loc 1 177 15 view .LVU281
 976 003e 264B     		ldr	r3, .L72
 179:.././simpleserial/simpleserial.c **** 			break;
 977              		.loc 1 179 31 view .LVU282
 978 0040 6278     		ldrb	r2, [r4, #1]
 177:.././simpleserial/simpleserial.c **** 	{
 979              		.loc 1 177 15 view .LVU283
 980 0042 1B68     		ldr	r3, [r3]
 177:.././simpleserial/simpleserial.c **** 	{
 981              		.loc 1 177 8 view .LVU284
 982 0044 0091     		str	r1, [sp]
 179:.././simpleserial/simpleserial.c **** 			break;
 983              		.loc 1 179 17 view .LVU285
 984 0046 2549     		ldr	r1, .L72+4
 985              	.LVL92:
 986              	.L58:
 177:.././simpleserial/simpleserial.c **** 	{
 987              		.loc 1 177 13 is_stmt 1 discriminator 1 view .LVU286
 177:.././simpleserial/simpleserial.c **** 	{
 988              		.loc 1 177 2 is_stmt 0 discriminator 1 view .LVU287
 989 0048 009E     		ldr	r6, [sp]
 990 004a 9E42     		cmp	r6, r3
 991 004c 02DB     		blt	.L60
 183:.././simpleserial/simpleserial.c **** 		err = SS_ERR_CMD;
 992              		.loc 1 183 2 is_stmt 1 view .LVU288
 183:.././simpleserial/simpleserial.c **** 		err = SS_ERR_CMD;
 993              		.loc 1 183 5 is_stmt 0 view .LVU289
 994 004e 0BD1     		bne	.L59
 184:.././simpleserial/simpleserial.c **** 		goto ERROR;
 995              		.loc 1 184 3 is_stmt 1 view .LVU290
 184:.././simpleserial/simpleserial.c **** 		goto ERROR;
 996              		.loc 1 184 7 is_stmt 0 view .LVU291
 997 0050 0123     		movs	r3, #1
 998 0052 E2E7     		b	.L71
 999              	.L60:
 179:.././simpleserial/simpleserial.c **** 			break;
 1000              		.loc 1 179 3 is_stmt 1 view .LVU292
 179:.././simpleserial/simpleserial.c **** 			break;
 1001              		.loc 1 179 17 is_stmt 0 view .LVU293
 1002 0054 009E     		ldr	r6, [sp]
 1003 0056 4643     		muls	r6, r0
 179:.././simpleserial/simpleserial.c **** 			break;
 1004              		.loc 1 179 5 view .LVU294
 1005 0058 765C     		ldrb	r6, [r6, r1]
 1006 005a 9642     		cmp	r6, r2
 1007 005c 04D0     		beq	.L59
 177:.././simpleserial/simpleserial.c **** 	{
 1008              		.loc 1 177 31 is_stmt 1 discriminator 2 view .LVU295
 177:.././simpleserial/simpleserial.c **** 	{
 1009              		.loc 1 177 32 is_stmt 0 discriminator 2 view .LVU296
 1010 005e 009E     		ldr	r6, [sp]
 1011 0060 0136     		adds	r6, r6, #1
 1012 0062 F6B2     		uxtb	r6, r6
 1013 0064 0096     		str	r6, [sp]
 1014              	.LVL93:
 177:.././simpleserial/simpleserial.c **** 	{
 1015              		.loc 1 177 32 discriminator 2 view .LVU297
 1016 0066 EFE7     		b	.L58
 1017              	.L59:
 190:.././simpleserial/simpleserial.c **** 		err = SS_ERR_LEN;
 1018              		.loc 1 190 2 is_stmt 1 view .LVU298
 190:.././simpleserial/simpleserial.c **** 		err = SS_ERR_LEN;
 1019              		.loc 1 190 15 is_stmt 0 view .LVU299
 1020 0068 E378     		ldrb	r3, [r4, #3]
 190:.././simpleserial/simpleserial.c **** 		err = SS_ERR_LEN;
 1021              		.loc 1 190 5 view .LVU300
 1022 006a 019A     		ldr	r2, [sp, #4]
 190:.././simpleserial/simpleserial.c **** 		err = SS_ERR_LEN;
 1023              		.loc 1 190 19 view .LVU301
 1024 006c 0533     		adds	r3, r3, #5
 190:.././simpleserial/simpleserial.c **** 		err = SS_ERR_LEN;
 1025              		.loc 1 190 5 view .LVU302
 1026 006e 9342     		cmp	r3, r2
 1027 0070 02DA     		bge	.L61
 1028              	.LVL94:
 1029              	.L63:
 191:.././simpleserial/simpleserial.c **** 		goto ERROR;
 1030              		.loc 1 191 3 is_stmt 1 view .LVU303
 191:.././simpleserial/simpleserial.c **** 		goto ERROR;
 1031              		.loc 1 191 7 is_stmt 0 view .LVU304
 1032 0072 0423     		movs	r3, #4
 1033 0074 D1E7     		b	.L71
 1034              	.LVL95:
 1035              	.L65:
 191:.././simpleserial/simpleserial.c **** 		goto ERROR;
 1036              		.loc 1 191 7 view .LVU305
 1037 0076 3500     		movs	r5, r6
 1038              	.LVL96:
 1039              	.L61:
 199:.././simpleserial/simpleserial.c **** 		if (data_buf[i] == FRAME_BYTE) {
 1040              		.loc 1 199 3 is_stmt 1 view .LVU306
 199:.././simpleserial/simpleserial.c **** 		if (data_buf[i] == FRAME_BYTE) {
 1041              		.loc 1 199 17 is_stmt 0 view .LVU307
 1042 0078 FFF7FEFF 		bl	getch
 1043              	.LVL97:
 199:.././simpleserial/simpleserial.c **** 		if (data_buf[i] == FRAME_BYTE) {
 1044              		.loc 1 199 15 view .LVU308
 1045 007c 6055     		strb	r0, [r4, r5]
 200:.././simpleserial/simpleserial.c **** 			err = SS_ERR_FRAME_BYTE;
 1046              		.loc 1 200 3 is_stmt 1 view .LVU309
 200:.././simpleserial/simpleserial.c **** 			err = SS_ERR_FRAME_BYTE;
 1047              		.loc 1 200 6 is_stmt 0 view .LVU310
 1048 007e 0028     		cmp	r0, #0
 1049 0080 CAD0     		beq	.L62
 198:.././simpleserial/simpleserial.c **** 		data_buf[i] = getch();
 1050              		.loc 1 198 30 is_stmt 1 view .LVU311
 198:.././simpleserial/simpleserial.c **** 		data_buf[i] = getch();
 1051              		.loc 1 198 21 is_stmt 0 view .LVU312
 1052 0082 E378     		ldrb	r3, [r4, #3]
 198:.././simpleserial/simpleserial.c **** 		data_buf[i] = getch();
 1053              		.loc 1 198 31 view .LVU313
 1054 0084 6E1C     		adds	r6, r5, #1
 1055              	.LVL98:
 198:.././simpleserial/simpleserial.c **** 		data_buf[i] = getch();
 1056              		.loc 1 198 9 is_stmt 1 view .LVU314
 198:.././simpleserial/simpleserial.c **** 		data_buf[i] = getch();
 1057              		.loc 1 198 11 is_stmt 0 view .LVU315
 1058 0086 0433     		adds	r3, r3, #4
 198:.././simpleserial/simpleserial.c **** 		data_buf[i] = getch();
 1059              		.loc 1 198 2 view .LVU316
 1060 0088 B342     		cmp	r3, r6
 1061 008a F4DA     		bge	.L65
 207:.././simpleserial/simpleserial.c **** 	if (data_buf[i] != FRAME_BYTE) {
 1062              		.loc 1 207 2 is_stmt 1 view .LVU317
 207:.././simpleserial/simpleserial.c **** 	if (data_buf[i] != FRAME_BYTE) {
 1063              		.loc 1 207 16 is_stmt 0 view .LVU318
 1064 008c FFF7FEFF 		bl	getch
 1065              	.LVL99:
 207:.././simpleserial/simpleserial.c **** 	if (data_buf[i] != FRAME_BYTE) {
 1066              		.loc 1 207 14 view .LVU319
 1067 0090 A055     		strb	r0, [r4, r6]
 208:.././simpleserial/simpleserial.c **** 		err = SS_ERR_LEN;
 1068              		.loc 1 208 2 is_stmt 1 view .LVU320
 208:.././simpleserial/simpleserial.c **** 		err = SS_ERR_LEN;
 1069              		.loc 1 208 5 is_stmt 0 view .LVU321
 1070 0092 0028     		cmp	r0, #0
 1071 0094 EDD1     		bne	.L63
 214:.././simpleserial/simpleserial.c **** 
 1072              		.loc 1 214 2 is_stmt 1 view .LVU322
 1073 0096 019B     		ldr	r3, [sp, #4]
 214:.././simpleserial/simpleserial.c **** 
 1074              		.loc 1 214 40 is_stmt 0 view .LVU323
 1075 0098 F6B2     		uxtb	r6, r6
 1076              	.LVL100:
 214:.././simpleserial/simpleserial.c **** 
 1077              		.loc 1 214 2 view .LVU324
 1078 009a F11A     		subs	r1, r6, r3
 1079 009c 0131     		adds	r1, r1, #1
 1080 009e C9B2     		uxtb	r1, r1
 1081 00a0 E018     		adds	r0, r4, r3
 1082 00a2 FFF7FEFF 		bl	unstuff_data
 1083              	.LVL101:
 217:.././simpleserial/simpleserial.c **** 	if (crc != data_buf[i-1]) {
 1084              		.loc 1 217 2 is_stmt 1 view .LVU325
 217:.././simpleserial/simpleserial.c **** 	if (crc != data_buf[i-1]) {
 1085              		.loc 1 217 16 is_stmt 0 view .LVU326
 1086 00a6 0920     		movs	r0, #9
 1087 00a8 02AB     		add	r3, sp, #8
 1088 00aa 023E     		subs	r6, r6, #2
 1089 00ac C018     		adds	r0, r0, r3
 1090 00ae F1B2     		uxtb	r1, r6
 1091 00b0 FFF7FEFF 		bl	ss_crc
 1092              	.LVL102:
 218:.././simpleserial/simpleserial.c **** 		err = SS_ERR_CRC;
 1093              		.loc 1 218 2 is_stmt 1 view .LVU327
 218:.././simpleserial/simpleserial.c **** 		err = SS_ERR_CRC;
 1094              		.loc 1 218 5 is_stmt 0 view .LVU328
 1095 00b4 635D     		ldrb	r3, [r4, r5]
 1096 00b6 8342     		cmp	r3, r0
 1097 00b8 01D0     		beq	.L64
 219:.././simpleserial/simpleserial.c **** 		goto ERROR;
 1098              		.loc 1 219 3 is_stmt 1 view .LVU329
 219:.././simpleserial/simpleserial.c **** 		goto ERROR;
 1099              		.loc 1 219 7 is_stmt 0 view .LVU330
 1100 00ba 0223     		movs	r3, #2
 1101 00bc ADE7     		b	.L71
 1102              	.L64:
 223:.././simpleserial/simpleserial.c **** 
 1103              		.loc 1 223 2 is_stmt 1 view .LVU331
 223:.././simpleserial/simpleserial.c **** 
 1104              		.loc 1 223 8 is_stmt 0 view .LVU332
 1105 00be E278     		ldrb	r2, [r4, #3]
 1106 00c0 A178     		ldrb	r1, [r4, #2]
 1107 00c2 6078     		ldrb	r0, [r4, #1]
 1108              	.LVL103:
 223:.././simpleserial/simpleserial.c **** 
 1109              		.loc 1 223 19 view .LVU333
 1110 00c4 0C24     		movs	r4, #12
 1111 00c6 009B     		ldr	r3, [sp]
 1112 00c8 5C43     		muls	r4, r3
 1113 00ca 044B     		ldr	r3, .L72+4
 1114 00cc 1B19     		adds	r3, r3, r4
 223:.././simpleserial/simpleserial.c **** 
 1115              		.loc 1 223 8 view .LVU334
 1116 00ce 9C68     		ldr	r4, [r3, #8]
 1117 00d0 05AB     		add	r3, sp, #20
 1118 00d2 A047     		blx	r4
 1119              	.LVL104:
 223:.././simpleserial/simpleserial.c **** 
 1120              		.loc 1 223 6 view .LVU335
 1121 00d4 3870     		strb	r0, [r7]
 1122 00d6 A1E7     		b	.L56
 1123              	.L73:
 1124              		.align	2
 1125              	.L72:
 1126 00d8 00000000 		.word	.LANCHOR0
 1127 00dc 04000000 		.word	commands
 1128              		.cfi_endproc
 1129              	.LFE9:
 1131              		.bss
 1132              		.align	2
 1133              		.set	.LANCHOR0,. + 0
 1136              	num_commands:
 1137 0000 00000000 		.space	4
 1140              	commands:
 1141 0004 00000000 		.space	192
 1141      00000000 
 1141      00000000 
 1141      00000000 
 1141      00000000 
 1142              		.text
 1143              	.Letext0:
 1144              		.file 2 "c:\\progra~1\\chipwh~1\\cw\\home\\portable\\armgcc\\arm-none-eabi\\include\\machine\\_def
 1145              		.file 3 "c:\\progra~1\\chipwh~1\\cw\\home\\portable\\armgcc\\arm-none-eabi\\include\\sys\\_stdint.
 1146              		.file 4 ".././hal/stm32f0/stm32f0_hal.h"
 1147              		.file 5 ".././simpleserial/simpleserial.h"
 1148              		.file 6 "<built-in>"
DEFINED SYMBOLS
                            *ABS*:00000000 simpleserial.c
C:\Users\mjzeec\AppData\Local\Temp\cci06p1k.s:16     .text.ss_crc:00000000 $t
C:\Users\mjzeec\AppData\Local\Temp\cci06p1k.s:24     .text.ss_crc:00000000 ss_crc
C:\Users\mjzeec\AppData\Local\Temp\cci06p1k.s:102    .text.hex_decode:00000000 $t
C:\Users\mjzeec\AppData\Local\Temp\cci06p1k.s:109    .text.hex_decode:00000000 hex_decode
C:\Users\mjzeec\AppData\Local\Temp\cci06p1k.s:290    .text.ss_puts:00000000 $t
C:\Users\mjzeec\AppData\Local\Temp\cci06p1k.s:297    .text.ss_puts:00000000 ss_puts
C:\Users\mjzeec\AppData\Local\Temp\cci06p1k.s:336    .text.stuff_data:00000000 $t
C:\Users\mjzeec\AppData\Local\Temp\cci06p1k.s:343    .text.stuff_data:00000000 stuff_data
C:\Users\mjzeec\AppData\Local\Temp\cci06p1k.s:410    .text.unstuff_data:00000000 $t
C:\Users\mjzeec\AppData\Local\Temp\cci06p1k.s:417    .text.unstuff_data:00000000 unstuff_data
C:\Users\mjzeec\AppData\Local\Temp\cci06p1k.s:482    .text.simpleserial_addcmd:00000000 $t
C:\Users\mjzeec\AppData\Local\Temp\cci06p1k.s:489    .text.simpleserial_addcmd:00000000 simpleserial_addcmd
C:\Users\mjzeec\AppData\Local\Temp\cci06p1k.s:561    .text.simpleserial_addcmd:00000034 $d
C:\Users\mjzeec\AppData\Local\Temp\cci06p1k.s:1140   .bss:00000004 commands
C:\Users\mjzeec\AppData\Local\Temp\cci06p1k.s:567    .text.simpleserial_init:00000000 $t
C:\Users\mjzeec\AppData\Local\Temp\cci06p1k.s:574    .text.simpleserial_init:00000000 simpleserial_init
C:\Users\mjzeec\AppData\Local\Temp\cci06p1k.s:607    .text.simpleserial_init:00000018 $d
C:\Users\mjzeec\AppData\Local\Temp\cci06p1k.s:731    .text.check_version:00000000 check_version
C:\Users\mjzeec\AppData\Local\Temp\cci06p1k.s:783    .text.ss_get_commands:00000000 ss_get_commands
C:\Users\mjzeec\AppData\Local\Temp\cci06p1k.s:613    .text.simpleserial_put:00000000 $t
C:\Users\mjzeec\AppData\Local\Temp\cci06p1k.s:620    .text.simpleserial_put:00000000 simpleserial_put
C:\Users\mjzeec\AppData\Local\Temp\cci06p1k.s:724    .text.check_version:00000000 $t
C:\Users\mjzeec\AppData\Local\Temp\cci06p1k.s:776    .text.ss_get_commands:00000000 $t
C:\Users\mjzeec\AppData\Local\Temp\cci06p1k.s:868    .text.ss_get_commands:00000034 $d
C:\Users\mjzeec\AppData\Local\Temp\cci06p1k.s:875    .text.simpleserial_get:00000000 $t
C:\Users\mjzeec\AppData\Local\Temp\cci06p1k.s:882    .text.simpleserial_get:00000000 simpleserial_get
C:\Users\mjzeec\AppData\Local\Temp\cci06p1k.s:1126   .text.simpleserial_get:000000d8 $d
C:\Users\mjzeec\AppData\Local\Temp\cci06p1k.s:1132   .bss:00000000 $d
C:\Users\mjzeec\AppData\Local\Temp\cci06p1k.s:1136   .bss:00000000 num_commands

UNDEFINED SYMBOLS
putch
memcpy
getch
